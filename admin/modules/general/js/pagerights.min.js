function PageRights(){this.address="../../admin/modules/general/pages/";this.viewID=-1}
PageRights.prototype.init=function(){$("body").click(function(){pageRights.hideMenu()});$("#page_list .link").each(function(){$(this).click(function(){var a=$(this);pageRights.loadRights(a)});$(this).bind("contextmenu",function(a){var b=$(this);pageRights.hideMenu();pageRights.showMenu(b);a.preventDefault()})});$("#page_list .directory_pointer").each(function(){$(this).bind("contextmenu",function(a){var b=$(this);pageRights.hideMenu();pageRights.showMenu(b);a.preventDefault()})});$("#pages_add_page").click(function(){pageRights.hideMenu();
pageRights.createNewPage()});$("#pages_visit_page").click(function(){pageRights.hideMenu();pageRights.visitPage()});$("#pages_edit_page").click(function(){pageRights.hideMenu();pageRights.loadRights($("#page_menu"))});$("#pages_delete_page").click(function(){pageRights.hideMenu();pageRights.deletePage()})};PageRights.prototype.hideMenu=function(){$("#dir_menu").css("display","none");$("#page_menu").css("display","none")};
PageRights.prototype.showMenu=function(a){var b=a.position(),c;c=a.hasClass("link")?"#page_menu":"#dir_menu";$(c).css("left",b.left+20+"px");$(c).css("top",b.top+5+"px");$(c).data("url",a.data("url"));$(c).css("display","block")};PageRights.prototype.createNewPage=function(){var a=$("#dir_menu").data("url");console.log("creating new page in "+a)};PageRights.prototype.visitPage=function(){var a=$("#page_menu").data("url");location.href="/"+a};
PageRights.prototype.deletePage=function(){var a=$("#page_menu").data("url"),b=parseInt($("#page_menu").css("height").replace("px","")),c=parseInt($("#page_menu").offset().top);confirmBox.init(b+c+60,pageRights.deletePageConfirm);confirmBox.show(languageAdmin.pagerights_delete_confirm_title,languageAdmin.pagerights_delete_confirm.replace("[page]",a))};
PageRights.prototype.deletePageConfirm=function(){var a;a=0<$("#page_menu").length?$("#page_menu").data("url"):$("#pages").data("url");$.post(pageRights.address+"delete",{url:a},function(){general.showPageRights()})};PageRights.prototype.loadRights=function(a){a=a.data("url");admin.show(pageRights.address+"view?url="+a,pageRights.loadRightsCallback)};
PageRights.prototype.loadRightsCallback=function(){$("#pages_back").click(function(){general.showPageRights()});$("#pages_update").click(function(){pageRights.edit()});$("#pages_delete").click(function(){var a=$("#pages").data("url");confirmBox.init(250,pageRights.deletePageConfirm);confirmBox.show(languageAdmin.pagerights_delete_confirm_title,languageAdmin.pagerights_delete_confirm.replace("[page]",a))});$("#pages_template_add").click(function(){pageRights.editView()});$("#pages_reset").click(function(){var a=
$("#pages").data("url");$("#pages_group").removeProp("selected").find("option:first").prop("selected","selected");$("#pages_accesslevel").removeProp("selected").find("option:first").prop("selected","selected");$.post(pageRights.address+"reset",{url:a})});pageRights.viewRights()};
PageRights.prototype.edit=function(){$("#pages_group").removeClass("invalid");$("#pages_accesslevel").removeClass("invalid");var a=$("#pages_accesslevel").val(),b=$("#pages_group").val(),c=$("#pages").data("url"),d=!1;""==b&&($("#pages_group").addClass("invalid"),d=!0);""==a&&($("#pages_accesslevel").addClass("invalid"),d=!0);d||$.post(this.address+"edit",{url:c,rights:a,group:b},function(){general.showPageRights()})};
PageRights.prototype.editView=function(){var a=$("#template_level").val(),b=$("#pages").data("url"),c=$("#view_name").val(),d=$("#viewGroups").val();errors=!1;var e=["view_name","template_level","viewGroups"],f;for(f in e)$("#"+e[f]).removeClass("invalid"),""==$.trim($("#"+e[f]).val())&&($("#"+e[f]).addClass("invalid"),errors=!0);errors||($("#pages_group").removeProp("selected").find("option:first").prop("selected","selected"),$("#pages_accesslevel").removeProp("selected").find("option:first").prop("selected",
"selected"),$.post(this.address+"addView",{url:b,rights:a,group:d,view:c},function(a){a=JSON.parse(a);if(-1!=a.id){var b=$("#right_list").data("styledir");$("#right_list tbody").append('<tr data-template="'+a.command+'" data-id="'+a.id+'" id="view_'+a.id+'"> \t<td style="width:50px"><img src="'+b+'/images/icons/delete.png" alt="'+a.deleteText+'" title="'+a.deleteText+'"></td> \t<td>'+a.command+"</td>\t<td>"+a.group+"</td>\t<td>"+a.level+"</td>    </tr>");pageRights.viewRights()}}))};
PageRights.prototype.viewRights=function(){$("#right_list tbody img").each(function(){$(this).off("click")});$("#right_list tbody img").each(function(){$(this).click(function(){var a=$(this);pageRights.deleteView(a)})})};
PageRights.prototype.deleteView=function(a){var b=a.parent().parent().data("id");a=a.parent().parent().data("template");pageRights.viewID=b;confirmBox.init(250,pageRights.deleteViewConfirm);confirmBox.show(languageAdmin.pagerights_delete_view_title,languageAdmin.pagerights_delete_confirm.replace("[page]",a))};PageRights.prototype.deleteViewConfirm=function(){id=pageRights.viewID;$("#view_"+id).remove();$.post(pageRights.address+"deleteView",{id:id})};var pageRights=new PageRights;