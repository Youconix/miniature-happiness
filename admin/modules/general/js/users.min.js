function Users(){this.url="../modules/general/users/"}Users.prototype.init=function(){$("#newUserButton, #newUserButton2").click(function(){users.showAddUserScreen()});$("#searchUsername").on("keyup",function(){users.filterUserList()});users.setUserListEvents()};Users.prototype.showAddUserScreen=function(){admin.show(users.url+"addScreen",users.addUserScreen())};Users.prototype.filterUserList=function(){var a=$.trim($("#searchUsername").val());$.get(users.url+"searchResults?username="+a,function(a){users.filterUserListCallback(a)})};
Users.prototype.filterUserListCallback=function(a){a=JSON.parse($.trim(a));$("#usertable tbody tr").each(function(){$(this).off("click")});$("#usertable tbody").empty();for(var b in a)$("#usertable tbody").append('<tr data-id="'+a[b].id+'"> \t<td>'+a[b].id+"</td> \t<td>"+a[b].username+"</td> \t<td>"+a[b].email+"</td> \t<td>"+a[b].loggedin+"</td> \t<td>"+a[b].registrated+"</td> \t</tr>");this.setUserListEvents()};
Users.prototype.setUserListEvents=function(){$("#usertable tbody tr").each(function(){$(this).click(function(){var a=$(this).data("id");admin.show(users.url+"view?userid="+a,users.showUserEvents)})})};
Users.prototype.showUserEvents=function(){$("#users_back").click(function(){general.showUsers()});$("#users_edit").click(function(){var a=$(this).data("id");admin.show(users.url+"editScreen?userid="+a,users.editUserScreen)});$("#users_delete").click(function(){var a=$(this).data("id"),b=$(this).data("username"),c=$(this).data("userid");a!=c&&(confirmBox.init(150,users.deleteConfirm),confirmBox.show(languageAdmin.users_delete_title,languageAdmin.users_delete.replace("[name]",b)))});$("#user_login_as").click(function(){var a=
$(this).data("id"),b=$(this).data("username"),c=$(this).data("userid");a!=c&&confirm(languageAdmin.login_as.replace("[username]",b))&&$.post(users.url+"login",{userid:a},function(a){location.href="/"})})};Users.prototype.deleteConfirm=function(){var a=$("#users_delete").data("id");$.post(users.url+"delete",{userid:a},function(){general.showUsers()})};
Users.prototype.editUserScreen=function(){$("#userUpdateButton").click(function(){users.checkUpdate()});$("#newGroup").on("change",function(){users.addGroup()});$("#newLevel").on("change",function(){users.addGroup()});users.setGrouplistEvents();users.showUserEvents()};
Users.prototype.addGroup=function(){var a=$("#newGroup").val(),b=$("#newGroup").text().split(" - "),c=$("#newLevel").val(),e=$("#newLevel").text(),d=$("#newGroup").data("id");""!=a&&""!=c&&($("#newGroup option").find('[value="'+a+'"]').remove(),$("#groupslist").append("<fieldset>"+$.trim(b[0])+" - "+e+' <img src="'+styleDir+'images/icons/delete.png" alt="'+deleteText+'" title="'+deleteText+'" class="delete" data-id="'+d+'" data-group="'+a+'" data-level="'+c+'"></fieldset>'),this.setGrouplistEvents(),
$.post(users.url+"addGroup",{userid:d,group:a,level:c}))};Users.prototype.removeGroup=function(a){var b=a.data("group"),c=a.data("level"),e=a.data("id"),d=a.parent().html().split(" - ");confirm(languageAdmin.users_delete_group.replace("[name]",d[0]))&&($("#newGroup").append('<option value="'+b+'">'+d[0]+"</option>"),a.remove(),$.post(users.url+"deleteGroup",{groupID:b,userid:e,level:c}))};
Users.prototype.setGrouplistEvents=function(){$("#groupslist fieldset img").each(function(){$(this).off("click");$(this).click(function(){var a=$(this);users.removeGroup(a)})})};
Users.prototype.checkUpdate=function(){var a=!0;$("#email").removeClass("invalid");$("#password1").removeClass("invalid");$("#password2").removeClass("invalid");validateEmail($("#email").val())||($("#email").addClass("invalid"),a=!1);""!=$("#password1").val()&&$("#password1").val()!=$("#password2").val()&&($("#password1").addClass("invalid"),$("#password2").addClass("invalid"),a=!1);var b=$("#userid").val(),c=$("#email").val(),e=0;$("#bot_1").is(":checked")&&(e=1);var d=0;$("#blocked_1").is(":checked")&&
(d=1);a&&$.post(users.url,{command:"edit",userid:b,email:c,bot:e,blocked:d,password:$("#password1").val(),password2:$("#password2").val()},function(){admin.show(users.url+"?command=view&userid="+b,users.showUserEvents)})};
Users.prototype.addUserScreen=function(){0==$("#username").length?setTimeout(function(){users.addUserScreen()},500):($("#users_back").click(function(){general.showUsers()}),$("#username").on("blur",function(){users.checkUsername()}),$("#email").on("blur",function(){users.checkEmail()}),$("#userSaveButton").click(function(){users.add()}),$("#username").trigger("blur"),$("#email").trigger("blur"))};
Users.prototype.checkUsername=function(){$("#username").removeClass("invalid");var a=$.trim($("#username").val());""!=a&&$.get(users.url+"checkUsername?username="+a,function(a){"1"!=a?($("#username").addClass("invalid"),$("#email").title(languageAdmin.users_username_taken)):$("#usernameOK").val(1)})};
Users.prototype.checkEmail=function(){$("#email").removeClass("invalid");var a=$.trim($("#email").val());""!=a&&$.get(users.url+"checkEmail?email="+a,function(a){"1"!=a?($("#email").addClass("invalid"),$("#email").title(languageAdmin.users_email_taken)):$("#emailOK").val(1)})};
Users.prototype.add=function(){if(validation.html5ValidationArray(["username","email","password1","password2"])&&0!=$("#usernameOK").val()&&0!=$("#emailOK").val()){var a=$("#username").val(),b=$("#email").val(),c=0;$("#bot_1").is(":checked")&&(c=1);var e=$("#password1").val(),d=$("#password2").val();e!=d?($("#password1").removeClass("valid").addClass("invalid"),$("#password1").title(languageAdmin.users_password_invalid),$("#password2").removeClass("valid").addClass("invalid"),$("#password2").title(languageAdmin.users_password_invalid)):
$.post(users.url+"add",{username:a,email:b,bot:c,password:e,password2:d},function(a){admin.show(users.url+"view?userid="+a,users.showUserEvents)})}};var users=new Users;